/*! Jsgridconcept - v0.0.1 - 2013-02-04
* https://github.com/InfiniteSpirals/JSGridConcept
* Copyright (c) 2013 InfiniteSpirals; Licensed MIT */
(function(e){var t=function(r,i){var s=[],o=0,u=e({});this.queueInProgress=!1,i.cellOffset=i.cellDiam+i.cellMargin;for(var a=0;a<i.rows;a++)for(var f=0;f<i.cols;f++){var l={backgroundX:f>0?i.cellOffset*f:f,backgroundY:a>0?i.cellOffset*a:a,background:i.background};s.push(new n(l,e(r[o]))),o++}var c=function(e){this.queueInProgress=e},h=function(){return this.queueInProgress},p,d,v=!1,m=this.sbQueue=function(e){e&&(p=e),E()?v||(v=!0,d=setInterval(m,250)):(v&&(clearInterval(d),v=!1),setTimeout(function(){p.call()},i.sbpause))},g={setAfter:function(){E()?setTimeout(g.setAfter,250):(g.setBackground(),g.setNextBlockText(),i.rollover&&g.setRollover())},setBackground:function(){for(var e=0;e<s.length;e++)s[e]instanceof n&&s[e].setBackground()},setRollover:function(){i.rollover=!0;for(var e=0;e<s.length;e++)s[e]instanceof n&&s[e].rollover()},setBlockText:function(t,r,o){var r=r||i.textxstart,o=o||i.textystart,t=t||!1,u=i.text.split("|");e.each(u,function(u,a){var f=i.cols*o+i.cols*u+r,l=a.split("");e.each(l,function(e,r){s[f+e]instanceof n&&(t?s[f+e].setNextHTML("<span>"+r+"</span>"):s[f+e].setHTML("<span>"+r+"</span>"))})})},setNextBlockText:function(){e.each(s,function(e,t){t instanceof n&&t.setNextHTML("")}),g.setBlockText(!0)},ripple:function(t){e.each(s,function(e,t){t instanceof n&&t.unbind()});var r=[],o=[],a=250;switch(t){case"x":var o=[];for(var f=0;f<i.cols;f++){var l=[];for(var h=0;h<i.rows;h++){var p=h>0?h*i.cols+f:h+f;l.push(s[p])}o.push(l)}break;case"y":var d=[];for(var h=0;h<i.rows;h++){var v=[];for(var f=0;f<i.cols;f++){var p=h+f>0?h*i.cols+f:0;v.push(s[p])}o.push(v)}break;default:o=s,a=25}e.each(o,function(t,i){var s=u.queue("ripple",function(t){setTimeout(function(){var s=function(t){t instanceof n?t.nextState():e.inArray(t,r)==-1&&e.inArray("ripple",x[t].getOption("chainMethods"))!=-1&&(x[t].invoke("ripple"),r.push(t))};Object.prototype.toString.call(i)==="[object Array]"?e.each(i,function(e,t){s(t)}):s(i),u.queue("ripple").length==0&&c(!1),t()},a)})}),c("true"),u.dequeue("ripple")},setNextBackground:function(){e.each(s,function(e,t){t instanceof n&&t.setOption("background",i.background).setNextBackground()})},scrollMessage:function(e,t){var e=e||i.scrollXRow,t=t||i.scrollText,r=[],o=i.cols*(e-1);for(var a=0;a<i.cols;a++)r.push(o+a);for(var f=0;f<(t.length<i.cols?i.cols+(i.cols-t.length):i.cols);f++)t+=" ";var l=t.split(""),h=[],p=0;r.reverse();for(var a=0;a<(l.length>=r.length?l.length:r.length);a++)h.push(s[r[a]]),u.queue("scroll",function(e){for(var t=0;t<=p;t++)h[t]instanceof n&&(i.scrollAnim?(h[t].setNextHTML("<span>"+(p<l.length?l[p-t]:" ")+"</span>",!0),h[t].nextState(!0)):h[t].setHTML("<span>"+(p<l.length?l[p-t]:" ")+"</span>"));var r,s=!1,o=function(){var t=!1;for(var i=0;i<=p;i++)h[i]instanceof n&&h[i].getCellTransitionStatus()&&(t=!0);t?s||(s=!0,r=setInterval(o,15)):(u.queue("scroll").length==0&&c(!1),s&&(clearInterval(r),s=!1),e())};i.scrollAnim?o():setTimeout(function(){u.queue("scroll").length==0&&c(!1),e()},i.scrollNonAnimDuration),p++});c("true"),u.dequeue("scroll")}};this.isAnimating=!1;var y,b=!1,w=function(){i.isSubgrid;if(!h()){var t=!1;for(var r=0;r<2;r++)e.each(s,function(e,r){r instanceof n&&r.getCellTransitionStatus()&&(t=!0)});t?(this.isAnimating=!0,b||(b=!0,y=setInterval(w,500))):(b&&(b=!1,clearInterval(y)),this.isAnimating=!1)}else this.isAnimating=!0,b||(b=!0,y=setInterval(w,500))},E=this.testAnimation=function(){return w(),this.isAnimating},S=function(){for(var e=0;e<i.initMethods.length;e++)g[i.initMethods[e]]&&g[i.initMethods[e]].call(this)},x=[];this.injectGrid=function(n,o,u){var n=e.extend({},i,n),a=[];for(var f=0;f<n.rows;f++){var l=i.cols*u+i.cols*f+o;for(var c=0;c<n.cols;c++){var h=l+c;a.push(r[h]),s[h].unbind(),s[h]=x.length}}x.push((new t(a,n)).setOption("isSubgrid","true"))},this.getSubgrid=function(e){return x[e]},this.invoke=function(e){return g[e]&&g[e].apply(this,Array.prototype.slice.call(arguments,1)),this},this.injectMethod=function(e,t){g[e]=t},this.setOption=function(e,t){return i[e]=t,this},this.getOption=function(e){return i[e]||""},S()},n=function(t,n){var r=["show-front","show-left","show-front","show-top"],i=["show-front","show-scroll","show-scroll1","show-scroll2"],s=["front","left","front","top"],o=["front","left","back","right"],u=[],a=0,f=0;this.setBackground=function(){n.css({backgroundImage:t.background,backgroundPositionX:-t.backgroundX,backgroundPositionY:-t.backgroundY}),n.find(".face").css({backgroundImage:t.background,backgroundPositionX:-t.backgroundX,backgroundPositionY:-t.backgroundY})},this.setNextBackground=function(){for(var e=0;e<s.length;e++)e!=a&&s[e]!=s[a]&&n.find("."+s[e]).css({backgroundImage:t.background})},this.setHTML=function(e){n.find(".face").html(e)},this.setNextHTML=function(e,t){var t=t||!1,r=t?o:s,i=t?f:a;for(var u=0;u<r.length;u++)u!=i&&r[u]!=r[i]&&n.find("."+r[u]).html(e)},this.setOption=function(e,n){return t[e]=n,this},this.getOption=function(e,n){return t[e]||""},this.nextState=function(e){var e=e||!1;if(!l){e?f<i.length-1?f++:f=0:a<r.length-1?a++:a=0;var t=e?i:r,s=e?f:a;l=!0,n.find(".cube").removeClass().addClass(t[s]).addClass("cube")}},this.rollover=function(){u.push("mouseover");var e=this.nextState;n.mouseover(function(){e()})},this.unbind=function(){e.each(u,function(e,t){n.unbind(t)}),u=[]};var l=!1,c=["webkitTransitionEnd","transitionend","oTransitionEnd"];e.each(c,function(e,t){n.bind(t,function(){l=!1})}),this.getCellTransitionStatus=function(){return l}};e.fn.JSGridConcept=function(n){var r={rows:6,cols:8,cellDiam:100,cellMargin:4,sbpause:1e3,cellType:"cube",scrollAnim:!0,scrollNonAnimDuration:100,isSubgrid:!1,text:"",textxstart:1,textystart:1,background:"url(images/psychedelic-violet.jpg)",skin:'<div class="cell"><div class="cube show-front"><div class="face front"></div><div class="face back"></div><div class="face right"></div><div class="face left"></div><div class="face top"></div><div class="face bottom"></div></div</div>',initMethods:["setBackground","setBlockText"]},n=e.extend(r,n);return this.each(function(r){for(var i=0;i<n.rows;i++)for(var s=0;s<n.cols;s++)e(this).append(n.skin);var o=e(this).find(".cell"),u=new t(o,n);setTimeout(function(){u.invoke("scrollMessage",2,"hello there!! why not read this long scroller!? It may contain some gems of wisdom!! note .. it doesn't :P")},500)})}})(jQuery),$(function(){$("#gridconcept").JSGridConcept({rows:6,cols:8,cellDiam:100,scrollAnim:!1,background:'url("images/coastline-of-maui.jpg")'})});