/*! Jsgridconcept - v0.0.1 - 2013-02-03
* https://github.com/InfiniteSpirals/JSGridConcept
* Copyright (c) 2013 InfiniteSpirals; Licensed MIT */
(function(e){var t=function(r,i){var s=[],o=0,u=e({}),a=!1;i.cellOffset=i.cellDiam+i.cellMargin;for(var f=0;f<i.rows;f++)for(var l=0;l<i.cols;l++){var c={backgroundX:l>0?i.cellOffset*l:l,backgroundY:f>0?i.cellOffset*f:f,background:i.background};s.push(new n(c,e(r[o]))),o++}var h,p=this.sbQueue=function(e){e&&(h=e),g()?setTimeout(p,250):setTimeout(function(){h.call()},i.sbpause)},d={setAfter:function(){g()?setTimeout(d.setAfter,250):(d.setBackground(),d.setNextBlockText(),i.rollover&&d.setRollover())},setBackground:function(){for(var e=0;e<s.length;e++)s[e].setBackground()},setRollover:function(){i.rollover=!0;for(var e=0;e<s.length;e++)s[e].rollover()},setBlockText:function(t,n,r){var n=n||i.textxstart,r=r||i.textystart,t=t||!1,o=i.text.split("|");e.each(o,function(o,u){var a=i.cols*r+i.cols*o+n,f=u.split("");e.each(f,function(e,n){t?s[a+e].setNextHTML("<span>"+n+"</span>"):s[a+e].setHTML("<span>"+n+"</span>")})})},setNextBlockText:function(){e.each(s,function(e,t){t.setNextHTML("")}),d.setBlockText(!0)},ripple:function(t){e.each(s,function(e,t){t.unbind()});var r=[],o=[],f=250;switch(t){case"x":var o=[];for(var l=0;l<i.cols;l++){var c=[];for(var h=0;h<i.rows;h++){var p=h>0?h*i.cols+l:h+l;c.push(s[p])}o.push(c)}break;case"y":var d=[];for(var h=0;h<i.rows;h++){var v=[];for(var l=0;l<i.cols;l++){var p=h+l>0?h*i.cols+l:0;v.push(s[p])}o.push(v)}break;default:o=s,f=25}e.each(o,function(t,i){var s=u.queue("ripple",function(t){setTimeout(function(){var s=function(t){t instanceof n?t.nextState():e.inArray(t,r)==-1&&e.inArray("ripple",b[t].getOption("chainMethods"))!=-1&&(b[t].invoke("ripple"),r.push(t))};Object.prototype.toString.call(i)==="[object Array]"?e.each(i,function(e,t){s(t)}):s(i),u.queue("ripple").length==0&&(a=!1),t()},f)})}),a=!0,u.dequeue("ripple")},setNextBackground:function(){e.each(s,function(e,t){t instanceof n&&t.setOption("background",i.background).setNextBackground()})},scrollMessage:function(t,r){console.log("here");var t=t||i.scrollXRow,r=r||i.scrollText;console.log("ystart ="+t+" text="+r);var o=e({}),u=[],a=i.cols*(t-1);for(var f=0;f<i.cols;f++)u.push(a+f);var l=r.split(""),c=[],h=0;for(var f=u.length-1;f>=0;f--)c.push(s[u[f]]),o.queue("scroll",function(e){for(var t=0;t<=h;t++)c[t]instanceof n&&(c[t].setHTML("<span>a</span>"),c[t].nextState(!0));var r=function(){var t=!1;for(var i=0;i<=h;i++)c[i]instanceof n&&c[i].getCellTransitionStatus()&&(t=!0);t?setTimeout(r,100):e()};r(),h++});o.dequeue("scroll")}},v=!1,m=function(){if(!a){var e=!1;for(var t=0;t<s.length;t++)s[t].getCellTransitionStatus()&&(e=!0);e?(v=!0,setTimeout(m,25)):v=!1}else v=!0,setTimeout(m,25)},g=this.testAnimation=function(){return m(),v},y=function(){for(var e=0;e<i.initMethods.length;e++)d[i.initMethods[e]]&&d[i.initMethods[e]].call(this)},b=[];this.injectGrid=function(n,o,u){var n=e.extend({},i,n),a=[];for(var f=0;f<n.rows;f++){var l=i.cols*u+i.cols*f+o;for(var c=0;c<n.cols;c++){var h=l+c;a.push(r[h]),s[h].unbind(),s[h]=b.length}}b.push(new t(a,n))},this.getSubgrid=function(e){return b[e]},this.invoke=function(e){return d[e]&&d[e].apply(this,Array.prototype.slice.call(arguments,1)),this},this.injectMethod=function(e,t){d[e]=t},this.setOption=function(e,t){return i[e]=t,this},this.getOption=function(e){return i[e]||""},y()},n=function(t,n){var r=["show-front","show-left","show-front","show-top"],i=["show-scroll","show-scroll1","show-scroll2","show-scroll3"],s=["front","left","front","top"],o=["left","back","right","front"],u=[],a=0,f=0;this.setBackground=function(){n.css({backgroundImage:t.background,backgroundPositionX:-t.backgroundX,backgroundPositionY:-t.backgroundY}),n.find(".face").css({backgroundImage:t.background,backgroundPositionX:-t.backgroundX,backgroundPositionY:-t.backgroundY})},this.setNextBackground=function(){console.log("current face="+s[a]);for(var e=0;e<s.length;e++)e!=a&&s[e]!=s[a]&&n.find("."+s[e]).css({backgroundImage:t.background})},this.setHTML=function(e){n.find(".face").html(e)},this.setNextHTML=function(e,t){var t=t||!1,r=t?o:s;for(var i=0;i<r.length;i++)i!=a&&r[i]!=r[a]&&n.find("."+r[i]).html(e)},this.setOption=function(e,n){return t[e]=n,this},this.getOption=function(e,n){return t[e]||""},this.nextState=function(e){console.log("nextState");var e=e||!1;if(!l){e?f<i.length-1?f++:f=0:a<r.length-1?a++:a=0;var t=e?i:r,s=e?f:a;l=!0,n.find(".cube").removeClass().addClass(t[s]).addClass("cube")}},this.rollover=function(){u.push("mouseover");var e=this.nextState;n.mouseover(function(){e()})},this.unbind=function(){e.each(u,function(e,t){n.unbind(t)}),u=[]};var l=!1,c=["webkitTransitionEnd","transitionend","oTransitionEnd"];e.each(c,function(e,t){n.bind(t,function(){l=!1})}),this.getCellTransitionStatus=function(){return l}};e.fn.JSGridConcept=function(n){var r={rows:6,cols:8,cellDiam:100,cellMargin:4,sbpause:1e3,cellType:"cube",text:"",textxstart:1,textystart:1,background:"url(images/psychedelic-violet.jpg)",skin:'<div class="cell"><div class="cube show-front"><div class="face front"></div><div class="face back"></div><div class="face right"></div><div class="face left"></div><div class="face top"></div><div class="face bottom"></div></div</div>',initMethods:["setBackground","setBlockText","setRollover"]},n=e.extend(r,n);return this.each(function(r){for(var i=0;i<n.rows;i++)for(var s=0;s<n.cols;s++)e(this).append(n.skin);var o=e(this).find(".cell"),u=new t(o,n),a=e({});a.queue("animation",function(e){u.setOption("text","hello!||and|welcome").setOption("textystart",1).invoke("setNextBlockText").invoke("ripple").invoke("setAfter").sbQueue(e,n.sbpause)}),a.queue("animation",function(e){u.setOption("background","url(images/psychedelic-violet.jpg)").setOption("text","Meet|Your|New|3D Grid|System").setOption("textystart",0).invoke("setNextBackground").invoke("setNextBlockText").invoke("ripple","x").invoke("setAfter").sbQueue(e,n.sbpause)}),a.queue("animation",function(e){u.setOption("text","some|more|stuff|in here").setOption("textystart",1).invoke("setNextBackground").invoke("setNextBlockText").invoke("ripple").invoke("setAfter").sbQueue(e,n.sbpause)}),a.queue("animation",function(e){u.setOption("background","url(images/Fractal_Broccoli.jpg)").setOption("text","fancy|some|fractal|broc?").setOption("textystart",2).invoke("setNextBackground").invoke("setNextBlockText").invoke("ripple","x").invoke("setAfter").sbQueue(e,n.sbpause)}),a.queue("animation",function(e){u.setOption("background","url(images/Fractal_Broccoli.jpg)").setOption("text","fancy|some|fractal|brostep").setOption("textystart",2).invoke("setNextBackground").invoke("setNextBlockText").invoke("ripple","x").invoke("setAfter").sbQueue(e,n.sbpause)}),a.queue("animation",function(e){u.setOption("background","url(images/psychedelic-violet.jpg)").setOption("text","some|more|stuff|in here").setOption("textystart",1).invoke("setNextBackground").invoke("setNextBlockText").invoke("ripple").invoke("setAfter").sbQueue(e,n.sbpause)}),setTimeout(function(){a.dequeue("animation")},n.sbpause)})}})(jQuery),$(function(){$("#gridconcept").JSGridConcept({rows:6,cols:8,background:'url("images/coastline-of-maui.jpg")'})});